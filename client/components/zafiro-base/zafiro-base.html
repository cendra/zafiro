<polymer-element name="zafiro-base" attributes="ngModel">
<script>
	Polymer({
		zs_: {
			attrs: ['ngModel'],
			origValues: {},
			reverseValues: {},
			evts: {},
			add: function(attr) {
				if(attr instanceof Array) {
					var self = this;
					attr.forEach(function(a) {
						if(typeof a == 'string') {
							self.attrs.push(a);
						} else if (typeof a == 'object') {
							for(var i in a) {
								!self.evts[i] && (self.evts[i] = []);
								self.evts[i].push(a[i]);
							}
						}
					});
				} else if(typeof attr == 'string') {
					this.attrs.push(attr);
				} else if (typeof attr == 'object') {
					for(var i in attr) {
						!this.evts[i] && (this.evts[i] = []);
						this.evts[i].push(attr[i]);
					}
				}
			}
		},
		scoped: function() {
			//Override this function to work with scoped elements
		},
		created: function() { 
			!this.scope && this.fire("zafiro:base:scopeLookup", {elem: this});
		},
		ready: function() { 
			!this.scope && this.fire("zafiro:base:scopeLookup", {elem: this});
		},
		attached: function() { 
			!this.scope && this.fire("zafiro:base:scopeLookup", {elem: this});
		},
		domReady: function() { 
			!this.scope && this.fire("zafiro:base:scopeLookup", {elem: this});
		},
		setScope: function(scope) {
			this.scope = scope;
			var self = this;
			Array.prototype.forEach.call(this.attributes, function(attribute) {
				var m;
				if(m = attribute.nodeValue.match(/\{\{([\w-]+)\}\}/)) {
					try {
						m[1] = JSON.parse(m[1]);
					} catch(e) {

					}
					self.zs_.add(attribute.name);
					attribute.nodeValue = m[1];
				}
			});
			this.zs_.attrs.forEach(function(attrName) {
				var scopeProp = self[attrName];
				self.zs_.origValues[attrName] = scopeProp;
				self.zs_.reverseValues[scopeProp] = attrName;
				self[attrName] = self.scope[scopeProp];
			});
			Object.observe(self, function(changes) {
				changes.forEach(function(change) {
					var scopeProp = self.zs_.origValues[change.name];
					if(scopeProp && change.object[change.name] != self.scope[scopeProp]) {
						self.scope[scopeProp] = change.object[change.name];
					}
				});
			});
			Object.observe(self.scope, function(changes) {
				self.scope.$apply();
				changes.forEach(function(change) {
					var attrName = self.zs_.reverseValues[change.name];
					if(attrName && change.object[change.name] != self[attrName]) {
						self[attrName] = change.object[change.name];
					}
				});
			});
			for(var i in this.zs_.evts) {
				this.addEventListener(i, function(e) {
					self.zs_.evts[i].forEach(function(evalAttr) {
						if(self[evalAttr] !== undefined)
							self.scope.$eval(self[evalAttr]);
					});
					e.preventDefault();
				});
			}
			this.scoped();
		}
	})
</script>
</polymer>